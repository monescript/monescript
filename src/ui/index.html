<html xmlns:v-on="http://www.w3.org/1999/xhtml" xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.18/c3.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js" charset="utf-8"></script>
</head>

<body>

    <form id="app">

        <total-monthly-chart style="width: 100%; height: 200px;" v-bind:journal="journal"></total-monthly-chart>
        <br/>
        <monthly-chart style="width: 100%; height: 200px;" v-bind:filter="filter" v-bind:journal="journal"></monthly-chart>
        <br/>
        <weekly-chart style="width: 100%; height: 200px;" v-bind:filter="filter" v-bind:journal="journal"></weekly-chart>

        <input type="file" id="input" v-on:change="handleFiles">

        <table>
            <tr><td>
                <account-filter v-model="filter"></account-filter>
            </td></tr>
            <tr><td>
                <accounts v-bind:filter="filter" v-bind:journal="journal"> </accounts>
            </td></tr>
        </table>

        <transaction-table v-bind:filter="filter" v-bind:journal="journal"></transaction-table>
    </form>

    <script id="account-filter-template" type="text/x-template">
      <div>
        <label>Account filter: </label>
        <input type="text" @change="updateFilter" v-model.lazy="filter.account"/>
        <label>Month: </label>
        <input type="number" @change="updateFilter" v-model.lazy="filter.month"/>
        <label>Payee: </label>
        <input type="text" @change="updateFilter" v-model.lazy="filter.payee"/>
      </div>
    </script>

    <script id="accounts-template" type="text/x-template">
        <ul>
            <li v-for="(value, key) in level()" >
                <b>{{ accountDisplay(value) }}</b>
                <div v-if="value.accounts != null && Object.keys(value.accounts).length > 0">
                    <accounts v-bind:accounts="value.accounts"> </accounts>
                </div>
            </li>
        </ul>
    </script>

    <script id="chart-template" type="text/x-template">
        <div :id="uniqId()"></div>
    </script>

    <script id="transaction-table-template" type="text/x-template">
        <table cellpadding="0" cellspacing="5">
            <template v-for="t in transactions">
                <template v-for="mp in [matchingPostings(t)]">
                    <tr>
                        <td>
                            {{t.date.year + '/' + t.date.month + '/' + t.date.day}} [{{txnWeekNumber(t)}}]
                        </td>
                        <td>
                            {{matchingPostingsTotal(t)}}
                        </td>
                        <td>
                            <i>{{t.payee}}</i>
                        </td>
                        <td>
                            <template v-if="mp.length == 1">
                                {{formattedAccount(mp[0].account)}}
                            </template>
                        </td>
                    </tr>
                    <template v-for="(p, index) in mp" v-if="mp.length > 1">
                        <tr>
                            <td>

                            </td>
                            <td style="font-size: smaller">
                                {{formattedAmount(p.amount)}}
                            </td>
                            <td>

                            </td>
                            <td>
                                {{formattedAccount(p.account)}}
                            </td>
                        </tr>
                    </template>
                </template>
            </template>
        </table>
    </script>

    <script src="_js/bundle.js"></script>
</body>
</html>
